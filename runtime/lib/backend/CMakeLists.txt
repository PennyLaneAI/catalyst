if(RUNTIME_CLANG_TIDY)
    if(NOT DEFINED CLANG_TIDY_BINARY)
        set(CLANG_TIDY_BINARY clang-tidy)
    endif()
    message(STATUS "Using CLANG_TIDY_BINARY=${CLANG_TIDY_BINARY}")
    set(CMAKE_CXX_CLANG_TIDY ${CLANG_TIDY_BINARY};
                         -extra-arg=-std=c++20;
                         --use-color;
    )
endif()

list(APPEND source_files LightningSimulator.cpp)

if(ENABLE_LIGHTNING_KOKKOS)
    list(APPEND source_files LightningKokkosSimulator.cpp)
endif()

list(APPEND libs lightning_interfaces)

if(ENABLE_OPENQASM)
    find_package(pybind11 REQUIRED)

    list(APPEND libs pybind11::embed)
    list(APPEND source_files openqasm/OpenQasmDevice.cpp)
endif()

add_library(rt_backend SHARED ${source_files})

target_include_directories(rt_backend PRIVATE   ${backend_includes}
                                                ${runtime_includes} 
                                                ${extensions_includes})

target_link_libraries(rt_backend PUBLIC ${CMAKE_DL_LIBS} ${libs})

set_property(TARGET rt_backend PROPERTY POSITION_INDEPENDENT_CODE ON)
